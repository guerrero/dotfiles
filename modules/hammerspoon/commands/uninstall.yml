---
- name: Run task dependencies for uninstall Hammerspoon app
  include_tasks: "{{ playbook_dir }}/lib/dependencies/{{ item }}.yml"
  loop:
    - os_is_mac
    - homebrew_is_installed

- block:
    - name: Ensure absence of Hammerspoon app
      homebrew_cask:
        name: hammerspoon
        state: absent
        install_options: force
      when: homebrew_is_installed

    - name: Ensure absence of files generated by Hammerspoon
      file:
        path: '{{ item }}'
        state: absent
      loop:
        - "/opt/homebrew/Caskroom/hammerspoon/"
        - "~/.hammerspoon"
        - "~/Library/Application Support/com.crashlytics/org.hammerspoon.Hammerspoon"
        - "~/Library/Caches/org.hammerspoon.Hammerspoon"
        - "~/Library/Preferences/org.hammerspoon.Hammerspoon.plist"
        - "~/Library/Saved Application State/org.hammerspoon.Hammerspoon.savedState"
  when: os_is_mac
